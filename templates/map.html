{% extends "base.html" %}

{% block title %}Map{% endblock %}

{% block content %}
  <!-- Search Ribbon -->
  <div class="search-ribbon">
    <h2>Search</h2>
    <div class="search-bar">
      <input type="text" placeholder="Search locations...">
    </div>
    <div class="top-searched">
      <h3>Top Searched</h3>
      <ul>
        <li>Location 1</li>
        <li>Location 2</li>
        <li>Location 3</li>
        <li>Location 4</li>
        <li>Location 5</li>
      </ul>
    </div>
  </div>

  <!-- Map Section -->
  <div class="map-container" id="map" style="height: 500px;"></div>

  <!-- Info Section -->
  <div class="info-section" id="info-section">
    <p>Select a location on the map or from the search ribbon to view more details.</p>
  </div>

  <!-- Leaflet.js Script -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>

  <!-- Pass markers to JavaScript as a JSON object -->
  <script>
    var markers = {{ markers | tojson }};
    
    // Initialize the map and set the view (center and zoom level)
    var map = L.map('map').setView([44.5646, -123.2620], 14);  // Centered on University of Oregon with zoom level 14

    // Set up the OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Loop through the markers array and create markers dynamically
    markers.forEach(function(markerData) {
      var marker = L.marker([markerData.lat, markerData.lng]).addTo(map);
      marker.bindPopup("<b>" + markerData.info + "</b>");

      // Event listener for when the marker is clicked
      marker.on('click', function() {
        // Update the info section with new content
        document.getElementById('info-section').innerHTML = `
          <h3>Marker Information</h3>
          <p>${markerData.info}</p>
          <p>Latitude: ${markerData.lat}</p>
          <p>Longitude: ${markerData.lng}</p>
        `;
      });
    });   
  </script>

{% endblock %}
